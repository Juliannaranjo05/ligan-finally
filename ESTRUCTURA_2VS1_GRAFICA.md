# ๐ Estructura Grรกfica del Sistema 2vs1

## ๐ฅ Layout de Cรกmaras en VideoChat 2vs1

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    VIDEOCHAT 2VS1                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                                                     โ  โ
โ  โ          CLIENTE (Pantalla Grande)                  โ  โ
โ  โ          Borde Rosa (#ff007a)                       โ  โ
โ  โ          Ocupa 2/3 del espacio                      โ  โ
โ  โ                                                     โ  โ
โ  โ          [Tu Cรกmara Local]                          โ  โ
โ  โ                                                     โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                          โ                          โ  โ
โ  โ    MODELO 1              โ    MODELO 2              โ  โ
โ  โ    Borde Verde           โ    Borde Azul            โ  โ
โ  โ    Ocupa 1/3 del espacio โ    Ocupa 1/3 del espacio โ  โ
โ  โ                          โ                          โ  โ
โ  โ  [Video Remoto 1]        โ  [Video Remoto 2]        โ  โ
โ  โ                          โ                          โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Flujo Completo de Llamada 2vs1

### 1๏ธโฃ Inicio de Llamada (Cliente)

```
โโโโโโโโโโโโโโโ
โ   CLIENTE   โ
โโโโโโโโฌโโโโโโโ
       โ
       โ 1. Selecciona modo 2vs1
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ  DualCallConfigModalโ
โ  - Selecciona 2 chicasโ
โ  - Valida saldo (60) โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โ 2. Confirma selecciรณn
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   Backend API       โ
โ   /api/calls/start  โ
โ   modelo_ids: [1,2] โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโ
       โ                 โ                 โ
       โผ                 โผ                 โผ
โโโโโโโโโโโโ      โโโโโโโโโโโโ     โโโโโโโโโโโโ
โ MODELO 1 โ      โ MODELO 2 โ     โ  CLIENTE โ
โNotificaciรณnโ    โNotificaciรณnโ   โ Esperandoโ
โcall_incomingโ   โsecond_model_โ   โ          โ
โ            โ    โinvitation โ    โ          โ
โโโโโโโฌโโโโโโโ    โโโโโโโฌโโโโโโ    โโโโโโโโโโโโ
      โ                 โ
      โ 3a. Acepta      โ 3b. Acepta
      โ                 โ
      โผ                 โผ
```

### 2๏ธโฃ Aceptaciรณn de Llamadas (Modelos)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  MODELO 1                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  DualCallIncomingOverlay                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ              โ
โ  โ ๐ Llamada 2vs1 Entrante             โ              โ
โ  โ                                      โ              โ
โ  โ  Cliente: [Avatar] [Nombre]          โ              โ
โ  โ  Tambiรฉn participarรก:                โ              โ
โ  โ  Modelo 2: [Avatar] [Nombre]         โ              โ
โ  โ                                      โ              โ
โ  โ  [โ Rechazar]  [โ Aceptar]         โ              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ              โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  MODELO 2                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  SecondModelInvitationOverlay                           โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ              โ
โ  โ ๐ฅ Invitaciรณn a Llamada 2vs1         โ              โ
โ  โ                                      โ              โ
โ  โ  Cliente: [Avatar] [Nombre]          โ              โ
โ  โ  Ya estรก en la llamada:              โ              โ
โ  โ  Modelo 1: [Avatar] [Nombre]         โ              โ
โ  โ                                      โ              โ
โ  โ  [โ Rechazar]  [โ Aceptar]         โ              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ              โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 3๏ธโฃ VideoChat Activo

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         VIDEOCHAT 2VS1                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                                                         โ  โ
โ  โ              CLIENTE (Local)                            โ  โ
โ  โ              [Cรกmara del Cliente]                       โ  โ
โ  โ              Estado: Activo                             โ  โ
โ  โ                                                         โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                            โ                            โ  โ
โ  โ      MODELO 1              โ      MODELO 2              โ  โ
โ  โ      [Video Remoto]        โ      [Video Remoto]        โ  โ
โ  โ      Estado: Conectado     โ      Estado: Conectado     โ  โ
โ  โ                            โ                            โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  Controles: [๐ค] [๐] [โถ๏ธ] [๐น] [โ๏ธ]                   โ  โ
โ  โ  Tiempo: 00:53  |  Monedas: 100  |  Regalos: 5         โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐๏ธ Estructura de Componentes

```
frontend/src/
โ
โโโ components/
โ   โโโ DualCallIncomingOverlay.jsx          โ Overlay para Modelo 1 (llamada 2vs1)
โ   โโโ SecondModelInvitationOverlay.jsx     โ Overlay para Modelo 2 (invitaciรณn)
โ   โ
โ   โโโ client/
โ   โ   โโโ DualCallConfigModal.jsx          โ Modal para seleccionar 2 chicas
โ   โ   โโโ CallModeSelector.jsx             โ Selector 1vs1 / 2vs1
โ   โ   โโโ videochatclient.jsx              โ Componente principal de videochat
โ   โ   โโโ components/
โ   โ       โโโ VideoDisplayImprovedClient.jsx  โ Layout 2vs1 (3 cรกmaras)
โ   โ
โ   โโโ modelo/
โ       โโโ homellamadas.jsx                 โ Manejo de notificaciones 2vs1
โ
โโโ contexts/
    โโโ GlobalCallContext.jsx                โ Lรณgica de llamadas 2vs1

backend/app/Http/Controllers/
โ
โโโ CallController.php
โ   โโโ startCall()                          โ Inicia llamada 2vs1
โ   โโโ answerCall()                         โ Acepta llamada (modelo 1 o 2)
โ   โโโ inviteSecondModel()                  โ Invita segundo modelo durante llamada
โ
โโโ VideoChatCoinController.php
โ   โโโ consumeCoins()                       โ Costo dinรกmico (10 โ 20 monedas/min)
โ
โโโ SessionEarningsController.php
    โโโ processSessionEarnings()             โ Earnings proporcionales

backend/database/migrations/
โโโ add_second_model_to_chat_sessions_table.php
    โโโ modelo_id_2
    โโโ modelo_2_invited_at
    โโโ modelo_2_answered_at
    โโโ modelo_2_status
```

## ๐ Flujo de Datos

```
โโโโโโโโโโโโโโโ
โ   CLIENTE   โ
โโโโโโโโฌโโโโโโโ
       โ
       โ POST /api/calls/start
       โ { modelo_ids: [57, 59] }
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   Backend (Laravel)     โ
โ                         โ
โ  - Valida modelos       โ
โ  - Verifica saldo (60)  โ
โ  - Crea ChatSession     โ
โ  - Genera room_name     โ
โ  - Crea notificaciones  โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
       โ
       โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโ
       โ                     โ                     โ
       โผ                     โผ                     โผ
โโโโโโโโโโโโ         โโโโโโโโโโโโ         โโโโโโโโโโโโ
โ MODELO 1 โ         โ MODELO 2 โ         โ  CLIENTE โ
โ          โ         โ          โ         โ          โ
โ Notif:   โ         โ Notif:   โ         โ Espera   โ
โ call_    โ         โ second_  โ         โ ambas    โ
โ incoming โ         โ model_   โ         โ acepten  โ
โ          โ         โ invitationโ        โ          โ
โโโโโโฌโโโโโโ         โโโโโโฌโโโโโโ         โโโโโโฌโโโโโโ
     โ                    โ                    โ
     โ POST /api/calls/answer                  โ
     โ { call_id, action: 'accept' }           โ
     โ                    โ                    โ
     โ                    โ POST /api/calls/answer
     โ                    โ { call_id, action: 'accept' }
     โ                    โ                    โ
     โผ                    โผ                    โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              LIVEKIT ROOM                            โ
โ                                                      โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ          โ
โ  โ CLIENTE  โ  โ MODELO 1 โ  โ MODELO 2 โ          โ
โ  โ (Local)  โ  โ(Remoto)  โ  โ(Remoto)  โ          โ
โ  โโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโ          โ
โ                                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฐ Sistema de Costos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    COSTOS 2VS1                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  LLAMADA 1VS1:                                          โ
โ  โโ Costo: 10 monedas/minuto                            โ
โ  โโ Saldo mรญnimo: 30 monedas                            โ
โ  โโ Earnings: 100% al modelo                            โ
โ                                                         โ
โ  LLAMADA 2VS1:                                          โ
โ  โโ Costo: 20 monedas/minuto (10 x modelo)             โ
โ  โโ Saldo mรญnimo: 60 monedas                            โ
โ  โโ Earnings: Proporcionales                            โ
โ      โโ Modelo 1: Desde inicio hasta fin o uniรณn M2    โ
โ      โโ Modelo 2: Desde uniรณn hasta fin                 โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Sistema de Notificaciones

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              NOTIFICACIONES 2VS1                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  Para MODELO 1:                                         โ
โ  โโ Tipo: call_incoming                                 โ
โ     โโ is_dual_model_call: true                         โ
โ     โโ other_model: { id, name, avatar }                โ
โ     โโ Muestra: DualCallIncomingOverlay                 โ
โ                                                         โ
โ  Para MODELO 2:                                         โ
โ  โโ Tipo: second_model_invitation                       โ
โ     โโ cliente: { id, name, avatar }                    โ
โ     โโ modelo1: { id, name, avatar }                    โ
โ     โโ Muestra: SecondModelInvitationOverlay            โ
โ                                                         โ
โ  Para CLIENTE:                                          โ
โ  โโ Tipo: call_accepted (cuando ambos aceptan)          โ
โ  โโ Tipo: second_model_joined (cuando M2 se une)        โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฏ Estados de la Llamada

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ESTADOS CHAT_SESSION                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  status: 'calling' โ 'active'                           โ
โ                                                         โ
โ  modelo_2_status:                                       โ
โ  โโ null        โ No hay segundo modelo                 โ
โ  โโ 'pending'   โ Invitaciรณn enviada                    โ
โ  โโ 'accepted'  โ Segundo modelo aceptรณ                 โ
โ  โโ 'rejected'  โ Segundo modelo rechazรณ                โ
โ                                                         โ
โ  Timestamps:                                            โ
โ  โโ started_at          โ Inicio de llamada             โ
โ  โโ modelo_2_invited_at โ Cuando se invitรณ M2           โ
โ  โโ modelo_2_answered_atโ Cuando M2 aceptรณ              โ
โ  โโ answered_at         โ Cuando M1 aceptรณ              โ
โ  โโ ended_at            โ Fin de llamada                โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐จ Layout Responsive

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    MรVIL (Mobile)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ                            โ
โ  โ    CLIENTE (2/3 altura) โ                            โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโ                            โ
โ  โโโโโโโโโโโโโฌโโโโโโโโโโโโ                              โ
โ  โ MODELO 1  โ MODELO 2  โ                              โ
โ  โ (1/3 alto)โ (1/3 alto)โ                              โ
โ  โโโโโโโโโโโโโดโโโโโโโโโโโโ                              โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    DESKTOP                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ          CLIENTE (2/3 altura)                   โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโ      โ
โ  โ     MODELO 1         โ     MODELO 2         โ      โ
โ  โ     (1/3 altura)     โ     (1/3 altura)     โ      โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโ      โ
โ                                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```





